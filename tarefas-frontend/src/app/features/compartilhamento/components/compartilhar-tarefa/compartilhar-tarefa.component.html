<div class="card">
  <div class="card-header">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-medium text-gray-900">Compartilhamentos</h3>
      <button
        *ngIf="!isCompartilhando"
        (click)="iniciarCompartilhamento()"
        class="btn-primary text-sm">
        Compartilhar
      </button>
    </div>
  </div>
  
  <div class="space-y-4">
    <!-- Lista de compartilhamentos -->
    <div *ngIf="compartilhamentos.length > 0" class="space-y-3">
      <div *ngFor="let compartilhamento of compartilhamentos" 
           class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
            <span class="text-sm font-medium text-primary-600">
                {{ compartilhamento.usuarioCompartilhado.nome.charAt(0) }}
            </span>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-900">
              {{ compartilhamento.usuarioCompartilhado.nome }} {{ compartilhamento.usuarioCompartilhado.sobrenome }}
            </p>
            <p class="text-xs text-gray-500">{{ compartilhamento.usuarioCompartilhado.email }}</p>
            <p class="text-xs text-gray-400">
              Compartilhado em: {{ compartilhamento.dataCompartilhamento | date:'dd/MM/yyyy' }}
            </p>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [class]="obterCorTipoCompartilhamento(compartilhamento.tipoCompartilhamento)">
            {{ obterLabelTipoCompartilhamento(compartilhamento.tipoCompartilhamento) }}
          </span>
          <button
            (click)="removerCompartilhamento(compartilhamento.id)"
            [disabled]="isLoading"
            class="text-red-400 hover:text-red-600 disabled:opacity-50"
            title="Remover compartilhamento">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Formulário de compartilhamento -->
    <div *ngIf="isCompartilhando" class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <div class="space-y-4">
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Email do usuário
          </label>
          <input
            type="email"
            [(ngModel)]="emailUsuario"
            (input)="onEmailChange()"
            (blur)="fecharSugestoes()"
            (focus)="onEmailChange()"
            placeholder="Digite o email do usuário..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm">
          
          <!-- Dropdown de sugestões -->
          <div *ngIf="mostrarSugestoes && usuariosSugeridos.length > 0" 
               class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
            <div *ngFor="let usuario of usuariosSugeridos" 
                 (click)="selecionarUsuario(usuario)"
                 class="px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0">
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                  <span class="text-sm font-medium text-primary-600">
                    {{ usuario.nome.charAt(0) || '?' }}
                  </span>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900">
                    {{ usuario.nome }} {{ usuario.sobrenome }}
                  </p>
                  <p class="text-xs text-gray-500">{{ usuario.email }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Tipo de acesso
          </label>
          <select
            [(ngModel)]="tipoCompartilhamento"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm">
            <option *ngFor="let tipo of tiposCompartilhamento" [value]="tipo.value">
              {{ tipo.label }} - {{ tipo.description }}
            </option>
          </select>
        </div>

        <div *ngIf="errorMessage" class="text-sm text-red-600 bg-red-50 p-2 rounded">
          {{ errorMessage }}
        </div>
        
        <div class="flex items-center space-x-2">
          <button
            (click)="compartilharTarefa()"
            [disabled]="!emailUsuario.trim() || isLoading"
            class="px-4 py-2 bg-primary-600 text-white text-sm rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">
            <span *ngIf="!isLoading">Compartilhar</span>
            <span *ngIf="isLoading">Compartilhando...</span>
          </button>
          <button
            (click)="cancelarCompartilhamento()"
            [disabled]="isLoading"
            class="px-4 py-2 bg-gray-300 text-gray-700 text-sm rounded-md hover:bg-gray-400 disabled:opacity-50">
            Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Estado vazio -->
    <div *ngIf="compartilhamentos.length === 0 && !isCompartilhando" class="text-center py-8">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhum compartilhamento</h3>
      <p class="mt-1 text-sm text-gray-500">Compartilhe esta tarefa com outros usuários.</p>
      <div class="mt-6">
        <button
          (click)="iniciarCompartilhamento()"
          class="btn-primary">
          Compartilhar Tarefa
        </button>
      </div>
    </div>
  </div>
</div>
